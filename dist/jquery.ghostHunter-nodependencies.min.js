/*! ghosthunter-nodependencies 2018-01-18 */

!function(t){var e=require("lunr");t.fn.ghostHunter=function(e){var i=t.extend({},t.fn.ghostHunter.defaults,e);if(i.results)return n.init(this,i),n},t.fn.ghostHunter.defaults={resultsData:!1,onPageLoad:!0,onKeyUp:!1,result_template:"<a href='{{link}}'><p><h2>{{title}}</h2><h4>{{prettyPubDate}}</h4></p></a>",info_template:"<p>Number of posts found: {{amount}}</p>",displaySearchInfo:!0,zeroResultsInfo:!0,before:!1,onComplete:!1,includepages:!1,filterfields:!1};var i=function(t){var e=new Date(t);return e.getDate()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getFullYear()},n={isInit:!1,init:function(t,i){var n=this;if(this.target=t,this.results=i.results,this.blogData={},this.result_template=i.result_template,this.info_template=i.info_template,this.zeroResultsInfo=i.zeroResultsInfo,this.displaySearchInfo=i.displaySearchInfo,this.before=i.before,this.onComplete=i.onComplete,this.includepages=i.includepages,this.filterfields=i.filterfields,this.index=e(function(){this.field("title",{boost:10}),this.field("description"),this.field("link"),this.field("plaintext",{boost:5}),this.field("pubDate"),this.field("tag"),this.ref("id")}),i.onPageLoad){window.setTimeout(function(){n.loadAPI()},1)}else t.focus(function(){n.loadAPI()});t.closest("form").submit(function(e){e.preventDefault(),n.find(t.val())}),i.onKeyUp&&t.keyup(function(){n.find(t.val())})},loadAPI:function(){if(this.isInit)return!1;var e=this.index,n=this.blogData;obj={limit:"all",include:"tags",formats:["plaintext"]},this.includepages&&(obj.filter="(page:true,page:false)"),t.get(ghost.url.api("posts",obj)).done(function(t){searchData=t.posts,searchData.forEach(function(t){var s=t.tags.map(function(t){return t.name});null==t.meta_description&&(t.meta_description="");var a=s.join(", ");a.length<1&&(a="undefined");var r={id:String(t.id),title:String(t.title),description:String(t.meta_description),plaintext:String(t.plaintext),pubDate:String(t.created_at),tag:a,link:String(t.url)};r.prettyPubDate=i(r.pubDate);var o=i(r.pubDate);e.add(r),n[t.id]={title:t.title,description:t.meta_description,pubDate:o,link:t.url}})}),this.isInit=!0},find:function(e){var i=this.index.search(e),n=t(this.results),s=[];n.empty(),this.before&&this.before(),(this.zeroResultsInfo||i.length>0)&&this.displaySearchInfo&&n.append(this.format(this.info_template,{amount:i.length}));for(var a=0;a<i.length;a++){var r=i[a].ref,o=this.blogData[r];n.append(this.format(this.result_template,o)),s.push(o)}this.onComplete&&this.onComplete(s)},clear:function(){t(this.results).empty(),this.target.val("")},format:function(t,e){return t.replace(/{{([^{}]*)}}/g,function(t,i){var n=e[i];return"string"==typeof n||"number"==typeof n?n:t})}}}(jQuery);